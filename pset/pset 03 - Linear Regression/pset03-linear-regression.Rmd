---
title: "PSET 03 - Linear Regression"
author: "S&DS 361"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(pubtheme)
library(leaflet)
library(htmltools)

```

## Part 1: Property values

The following data set contains information about properties in Branford, CT. Each row is a property, and the columns contain information about that property.

```{r}
b = read.csv('data/branford.csv')

## let's get rid of Mobile Homes
## and keep only the columns we will be working with
b = b %>% 
  filter(style!='Mobile Home') %>% 
  select(value, living, beds, baths, halfbaths, miles_to_coastline) 
head(b,2)
```

The column `value` indicates the assessed value of that property. The column `living` indicates the square feet of the living area of the property, `beds` is the number of bedrooms, `baths` is the number of full bathrooms, and `halfbaths` is the number of half bathrooms.

#### 1. Fit a linear regression model using `log(value)` as the outcome and `living` as a predictor, and another model with `log(living)` as a predictor.  Which model do you think is better? Why?



#### 2. Try adding `beds`, `baths`, and `halfbaths` as predictors to the model above. Do those predictors improve the model? Why or why not?



#### 3. Create a column `baths2` that is the sum of `baths` and 0.5*`halfbaths`. Fit a linear regression model with `living` and `beds` as before, but use `baths2` instead of `baths` and `halfbaths`. Is this model better, worse or similar? Why?



#### 4. Plot `log(value)` vs `log(miles_to_coastline)`. Does this relationship look more linear than `log(value)` vs `miles_to_coastline`?



#### 5. Fit a model like your model above but with `miles_to_coastline` as an additional predictor, and one like your model above but with `log(miles_to_coastline)` as an additional predictor. Which model is better? Why or why not? Explain what you mean by "better".





## Part 2: Census Data

The following data set contains information from the US Census. Each row is a census tract, and the columns contain information about that census tract. 

```{r}
census = readRDS('data/tracts.and.census.with.EV.stations.rds')
census = census[census$state=='CT',]
df = census@data ## just the data frame, without the polygons
```

#### 6. Build a simple linear regression model that describes the relationship between median household income `hh.income` and median housing value `house.value` by census tract. Explain how you decided which was the independent and which was the dependent variable. Describe any potential issues with your choice, if any.  



#### 7. For which census tracts in CT does your model perform well? Not as well? What do those census tracts have in common?



## Part 3: Super Bowl predictions

The Superbowl is the championship game of the National Football League (NFL). The game will likely be the most watched broadcast in the US this year (in 2023, the Superbowl has twice the viewership of the next most watched broadcast, according to https://www.sportico.com/law/analysis/2024/super-bowl-security-1234765332/). 

Let's use our regression skills to predict the outcome of this year's Superbowl.

```{r}
g = readRDS('data/games.rds')

g = g %>% 
  filter(lg=='nfl', season %in% 2023) %>%
  select(date, away, home, ascore, hscore, season, gid)

da = g %>% select(date, away, ascore, home, hscore, season, gid) %>% mutate(ha = 'away')
dh = g %>% select(date, home, hscore, away, ascore, season, gid) %>% mutate(ha = 'home')
colnames(da) = c('date', 'team', 'score',  'opp', 'opp.score', 'season', 'gid', 'ha')
colnames(dh) = c('date', 'team', 'score',  'opp', 'opp.score', 'season', 'gid', 'ha')
dd = bind_rows(da, dh) %>% 
  arrange(date, gid)
head(dd)

## Super Bowl, and games before the Super Bowl
sb = dd %>% filter(date=='2024-02-11')
dd = dd %>% filter(date< '2024-02-11')
```

#### 8. Build a model with `score` as the outcome and `ha` (home or away), `team`, and `opp` as the predictors, using only games played before the Super Bowl (the data frame `dd`). Are the linear regression assumptions satisfied?


#### 9. Use this model to predict the outcome of the Super Bowl. 


#### 10. Suppose the betting odds say that the San Francisco 49ers (SF) are favored to win by 1.5 points. If you bet on the 49ers, and they win by 2 or more points, you win money, and if they win by 1 point or lose, you lose money. Should you bet on the 49ers? If you do this assignment after the Super Bowl, ignore the outcome when answering this question. :)



