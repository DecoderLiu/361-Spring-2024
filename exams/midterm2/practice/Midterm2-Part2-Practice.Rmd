---
title: "Midterm 2, Part 2 Practice"
author: "S&DS 361"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(pubtheme)
```

## Poisson regression vs Linear regression

```{r}
d = readRDS('data/games.rds')

nba = d %>% 
  filter(lg == 'nba', 
         season %in% 1990:2023, 
         season.type == 'reg') %>%
  select(date, away, home, 
         ascore, hscore, season, gid)
head(d)

da = nba %>% select(date, away, ascore, home, hscore, season, gid) %>% mutate(ha = 'away')
dh = nba %>% select(date, home, hscore, away, ascore, season, gid) %>% mutate(ha = 'home')
colnames(da) = c('date', 'team', 'score',  'opp', 'opp.score', 'season', 'gid', 'ha')
colnames(dh) = c('date', 'team', 'score',  'opp', 'opp.score', 'season', 'gid', 'ha')
dd = bind_rows(da, dh) %>% 
  arrange(date, gid)
head(dd)

```

```{r}
ds = dd %>%
  group_by(team, season) %>%
  summarise(avg.score = mean(score), 
            avg.opp.score = mean(opp.score))
         
head(ds,2)
```

```{r}
dd = dd %>%
  mutate(prev.season = as.character(as.numeric(season) - 1)) %>%
  left_join(ds, 
            by = c('team', 
                   'prev.season' = 'season')) %>%
  filter(!is.na(avg.score), 
         score != 0) %>%
  rename(avg.score.prev = avg.score)
head(dd)

```

```{r}
g = ggplot(dd,
           aes(x = avg.score.prev, 
               y = score)) +
  geom_point(color = pubdarkgray,
             alpha = 0.05)

g %>% pub()
```


We previously fit this linear regression model for scores in NBA games.


```{r}
lm1 = lm(score ~ avg.score.prev, data=dd)
summary(lm1)
```


## 1. Data exploration 

Consider only one predictor `avg.score.prev` and outcome `score`. Perform some data exploration and visualization to determine whether linear regression assumptions or Poisson regression assumptions appear to be met more closely. (Feel free to copy/paste code that we've done previously.)


## 2. Poisson Regression 

Fit a Poisson regression model. What are the best ways to compare your linear regression and Poisson regression models? Which model do you think is best for this data? 



## Simulation

## 3. Simulate 10,000 data points with these properties.

1. $x$ is uniformly distributed on the interval $[-1,1]$. 
2. $y$ is 0 or 1. 
3. When $x$ is near -1, $y$ is usually 0, but not always. 
4. When $x$ is near  1, $y$ is usually 1, but not always. 
5. When $x$ is near  0, $y$ is sometimes 0 and sometimes 1, in roughly equal proportions. 
6. As $x$ goes from -1 to 1, $y$ smoothly transitions from having more 0s to having more 1s. 

## 4. Plot the simulated points

Plot the simulated points generated in #3 and add a smooth curve to the scatter plot. 

